<!DOCTYPE html>
<html>
    <head>
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">
      <link href="https://zurb.com/playground/uploads/upload/upload/430/tribute.css">

        <title>Test</title>
      <style>
        html,body{background-color:white
          -webkit-user-select: none; 
          -moz-user-select: none;     
          -ms-user-select: none;
          user-select: none;  
        }
        .hl{
        background-color:yellow;
        }
        #text span{cursor:pointer}
        @media only screen and (min-width: 993px) {
          #text{margin-right:175px}
        }
      </style>
  </head>
  <body class="white">
    <div class="container">
      <div id="status" class="hide"></div>
        <div id="text">
        Ģimenes noslēpums
      
         Džeisonam pēc dažiem mēnešiem būs trīs gadi. Viņa vecāki, Helēna un Džeimss jūtas vīlušies attiecībā uz dēla uzvedību: tā vienā mirklī var mainīties nomierīgas, pieauguša cilvēka uzvedības līdz pat agresīvai un kaprīzai uzvedībai. 


Vecaistēvs Džons, Helēnas tēvs, mierina viņus, šo satraukumu par bērnu uzvedību norakstot uz pieredzes trūkumu.  Viņš mēģina pārliecināt viņus, ka viss būs kārtībā.
“Katrs bērnspieaug un nobriest sev raksturīgā tempā” saka vecaistēvs.„Katrā ziņā kopā ar mani zēns vienmēr labi uzvedas. Mēs pavadam pēcpusdienas kopā un šis laiks ir pilnībā bez jebkādām nepatikšanām. Parkā Džeisons ir lielisks sabiedrotais. Labas uzvedības un paklausības paraugs.”
	
	Kad Helēna mēģina no Džeisona izvilkt viņa labās uzvedības noslēpumu, runājot par tām reizēm, kad viņi ir kopā ar vectēvu, Džeisons tikai paskatās uz savām kājām un atbild: „Mēs spēlējamies.”


	„Ko jūs spēlējat?” jautā māte.


	„Visu kaut ko”.


	Tā saruna beidzas. 
Helēna nevar saprst, kāpēc Džeisonam nekad nav niķi, kad viņš ir kopā ar vecotēvu. Kad viņa vaicā savam tēvam, kā viņš tiek tik labi galā ar Džeiso, tēvs atbild: “Es pieļauju, ka tas ir noslēpums starp mani un Džeisonu”. 


	Džeims un Helēna bieži vien runā par to, kā labāk audzināt dēlu. Viņa apraksta kādu epizodi par notikušo virtuvē, kas raksturo viņu dēlu. 
Zēns palūdza mātei ābolu.
	„Aizej uz turieni, kur mēs turam ābolus un paņem sev,” māte teica zēnam.


	„Bet tu esi tā, kas parasti atnes un liek ēdienu galdā,” viņš atbildēja.


	„Džeison,  tu tagad esi lielāks, pietiekami liels, lai varētu pats paņemt…”
           
           Džeisons atnesa divus ābolus.


	„Vai tu pamanīji, ka paņēmi divus ābolus?” jautāja māte.


	„Man tie ļoti garšo”.


	„Bet tu apēdīsi tikai vienu. Noliec vienu atpakaļ, Džeison.”	


	


	Zēns kādu brīdi ir domīgs. Tad viņš atbild, 
„Es to atnesu tev, mammīt. Ja tu to negribi es to apēdīšu.”


„Paldies, ka padomāji par mani,  Džeison.”	


	Džeisons vēro kā māte apēd savu ābolu. Helēna ar viņu laiku pa laikam saskatās un īpaši uzsmaida. Viņa pat izdomāja smieklīgu dziesmiņu par ābolu, kas pakāpeniski pazūd.  Viņa jutās tā, it kā abi būtu iesaistīti kādā slepenā abiem vien saprotamā jokā. 
	
	Nākamajā dienā, kad viņi iet prom no mazo bērnu skoliņas, Džeisons lūdz mātei kūku, ko viņš ierauga veikala skatlogā, kam viņi iet garām.


„Nē, mīļais, mēs varēsim kaut ko garšīgu dabūt mājās. Mums ir jāiet. Tētis gaida mašīnā.”
         
 „Bet es gribu to kūku!”




„Mums mājās būs dzēriens un cepumi. Kūkas ir īpašiem gadījumiem.


„Es gribu to kūku!”
		
	Tā kā Helēna nepiekrīt pirkt kūku, Džeisons sāk niķoties ar raudāšanu, kliegšanu, speršanu un apvainojumiem. 
Šādās situācijās Helēna parasti stingri tur zēnu savās rokā un pēc ciešā apskāviena viņa steidzas tālāk, cenšoties novērst zēna uzmanību norādot uz policijas mašīnas mirguļojošām gaismām.
Bet Džeisons nenomierinās. Līdzko viņš ierauga tēvu, kas gaida mašīnā otrpus ielai, viņš izraujas no mātes rokas un skrien pāri ielai nemaz nepaskatotiessānis.


Helēna un Džeimss abi kliedz. Kliegšana aptur Džeisona pusceļā. Tad dzirdama mašīnas kaukšana un bremzēšanas troksnis, par laimi, nekas vairāk par izbīli nav atgadījies.


Kad Džeimss nokļūst līdz vietai, kur viņa dēls stāv sastindzis, viņš dēam uzšauj pa dibenu, sakot: “Vai mēs tev miljons reižu neesam teikuši nekad nešķērsot ielu vienam pašam? Nekad vairs tā nedari! Nekad! Tagad kāp mašīnā, lai varam aprunāties.”          
        
Džeisons sāk skaļi raudāt. Kad māte pienāk, viņa apskauj zēnu, sakot: “Viss ir labi, Džeison! Nekas nav atgadījies. Tikai liels izbīlis. Lūdzu, neraudi! Tas vairs neatkārtosies.”


“Bet tētis man iesita. Tu saki nekad nesit.”
	
“Bet tu slikti rīkojies un varēji nopietni savainoties.” 








Džeimss pārtrauc:


“Tu esi pārlieku pielaidīga attiecībā uz zēnu. Viņam ir nepieciešama stingra roka. Pagaidi, kamēr tiksim mājās.”


Pa ceļam uz mājām, Džeimss pārtrauc klusumu dusmīgā balsī sakot:


“Šovakar, Džeison, tu nedabūsi saldo ēdienu un pēc vakariņām uzreiz dosies gulēt. Tieši tāpat tas būs rīt.”


Helēna gribētu teikt, ka tas nav piemērots sods bērnam, bet ņemot vērā, ka zēns sēž blakus, viņa nolemj paklusēt. 


Tiklīdz viņi ir tikuši mājās, neviens vairs nepārrunā notikušo. Bez jebkādiem apskāvieniem un mājās valda dusmīgs klusums.  Helēna noliek dēlu gulēt bez saldā ēdiena. 


Gandrīz aizmidzis Džeisons jautā mātei:
“Māmiņ, ja es rīt viens nešķērsošu ielu, vai tu man nopirksi mazu kūciņu kā vectēvs to dara.”
       
        </div>
      </div>
     <a class="btn-floating waves-effect waves-light transparent button-collapse" style="position:fixed;top:5px;right:5px" data-activates="slide-out" ><i class="material-icons black-text">menu</i></a>
   
    
     <ul id="slide-out" class="side-nav fixed">
       <li class="row">
         <a class="col s4 btn green waves-effect waves-light" onclick="storesel()">add fact</a>
         <a class="col s3 btn green waves-effect waves-light hide"><b>F</b></a>
         <a class="col s3 btn blue waves-effect waves-light"><b>@</b></a>
         <a class="col s3 btn red waves-effect waves-light"><b>#</b></a>
       </li>
       <li id="dbdisplay"></li>
    </ul>
    
    
    
    
    
    <script>var pg = false;</script>
    <script type="text/javascript" charset="utf-8" src="cordova.js" id="cordova" onload="pg=true;"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>
    <script src="https://zurb.com/playground/uploads/upload/upload/435/tribute.js"></script>
    <script type="text/javascript">
      var tribute;
      $(document).ready(function(){
        $('#status').prepend('document ready<br>');
       if(pg===true){
         $('#status').prepend('phonegap<br>');
         $(document).on('deviceready', onDeviceReady);
       }
        else{
        $('#status').prepend('not phonegap<br>');
          init();
        }
      });
      
      function onDeviceReady() {    
        $('#status').prepend('device ready<br>');
        init()
      } 
      
      var db = {
        settings:{},
        facts:{},
        people:{},
        issues:{}
      }
      
      var factnum = 0;
      
      var thisfact = {
        segments:{},
        id:'',
        comment:''
      };
      
      
      
      var down = false;
      
      function init(){
          $('.button-collapse').sideNav({
      menuWidth: 300, 
      edge: 'right', 
      closeOnClick: false, 
      draggable: true 
    }
  );
        
        
         tribute = new Tribute({
           collection: [{
             trigger: '@',
             fillAttr: 'value',
             selectTemplate: function (item) {
               return '@' + item.original.value;
             },
             values: [],
             allowSpaces: false
           },
            {
             trigger: '#',
             fillAttr: 'value',
              selectTemplate: function (item) {
               return '#' + item.original.value;
             },
             values: [],
             allowSpaces: false
           }
                       ]
         });          
        
        var html = '<span>'
        +$('#text').text()
        .replace(/\./g,'.</span><span>')
        .replace(/,/g,',</span><span>')
        .replace(/:/g,':</span><span>')
       .replace(/\n/g,'<br>')
        .replace(/;/g,';</span><span>')
        .replace(/!/g,'!</span><span>')
        .replace(/\?/g,'?</span><span>')
        .replace(/'/g,"'</span><span>")
       .replace(/"/g,'"</span><span>')
        +'</span>';
        
        $('#text').html(html);
        
        $(document).mousedown(function(){down=true});
        $(document).mouseup(function(){down=false});
        var num = 1;
        $('#text span').each(function(){
        $(this).attr('id',num);
          $(this).mouseover(function(){        if(down){hl($(this))}        });
          $(this).click(function(){       hl($(this))        });
          num++;
        });
      }
      
      function hl(dis){
        dis.toggleClass('hl');
        var id = dis.attr('id');
        if(thisfact['segments'][id]===undefined){thisfact['segments'][id]=dis.text()}
        else{delete thisfact['segments'][id]}
      }
      
      function storesel(){
        if(Object.keys(thisfact['segments']).length>0){
      db['facts'][factnum]=thisfact;
      factnum++;
        thisfact={
          segments:{},
          id:'',
          comment:''
      };
        $('.hl').removeClass('hl');
          Materialize.toast('fact stored',2000)
        console.log(db);
       displayfacts();
        }else{
        Materialize.toast('facts without reference do not count',2000);
        }
      }
      
      function displayfacts(){
        $('#dbdisplay').html('');
      var fac = db.facts;

        for (var t in fac){
          var html = '';
          var selector = '';
          for (var g in fac[t]['segments']){
          selector+='#'+g+' ,'
          }
          selector=selector.slice(0,-2)
        html+='<div class="card green lighten-2" id="fact'+t+'" onmouseover="$(\''+selector+'\').addClass(\'green\')" onmouseout="$(\''+selector+'\').removeClass(\'green\')">'+fac[t].comment+'</div>';
          $('#dbdisplay').append(html);
          
          tribute.attach(document.getElementById('fact'+t));
    document.getElementById('fact'+t).addEventListener('keyup',function(kup){factupdate(t,$(this).text(),kup.code)});
          
          document.getElementById('fact'+t).addEventListener('tribute-no-match', function (e) {digiting=true;});
          document.getElementById('fact'+t).addEventListener('tribute-replaced', function (e) { console.log(e);});
        }
        
      }
      
      var digiting = false; var lasttrigger ='';
      
function factupdate(t,text,kup){
  var lc = text.substr(text.length-1,1);
  console.log(t);
  if(lc==='@'||lc==='#'){lasttrigger=lc}
  db.facts[t]['comment']=text; 
  if(digiting && kup==='Space'){
    var name = text.substring(text.lastIndexOf(lasttrigger) + 1, text.length-1);
    if (lasttrigger==='@'){
      if(db.people[name]===undefined){
        db.people[name]={
          key:name,
          value:name,
          facts:[t]
        }
        tribute.append(0,[db.people[name]])
      }
      else{db.people[name].facts.push(t)}
    }
    if (lasttrigger==='#'){
      if(db.issues[name]===undefined){
        db.issues[name]={
          key:name,
          value:name,
          facts:[t]
        }
        tribute.append(1,[db.issues[name]])
      }
      else{db.issues[name].facts.push(t)}
    }  
    digiting = false;
    console.log(db);
  }      
}
      
      </script> 
    </body>
</html>
